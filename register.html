<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro · Tienda</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <nav id="mainNav" class="navbar navbar-expand-lg navbar-dark bg-primary"></nav>
  <main class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h1 class="h4 mb-3">Crear cuenta</h1>
            <form id="formRegister" novalidate>
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label class="form-label" for="name">Nombre</label>
                  <input id="name" name="name" class="form-control" required />
                  <div class="invalid-feedback">Ingresa tu nombre.</div>
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label" for="email">Correo</label>
                  <input id="email" name="email" type="email" class="form-control" required />
                  <div class="invalid-feedback">Correo inválido.</div>
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label" for="password">Contraseña</label>
                  <input id="password" name="password" type="password" class="form-control" required minlength="8" maxlength="32" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}" />
                  <div class="form-text">Mín 8, máx 32, con mayúscula, minúscula, número y caracter especial.</div>
                  <div class="invalid-feedback">La contraseña no cumple las reglas.</div>
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label" for="confirm">Confirmar</label>
                  <input id="confirm" name="confirm" type="password" class="form-control" required />
                  <div class="invalid-feedback">Las contraseñas no coinciden.</div>
                </div>
                <div class="col-12">
                  <label class="form-label" for="role">Rol</label>
                  <select id="role" name="role" class="form-select" required>
                    <option value="">Selecciona</option>
                    <option value="customer">Cliente</option>
                    <option value="admin">Administrador</option>
                  </select>
                  <div class="invalid-feedback">Selecciona un rol.</div>
                </div>
                <div class="col-12">
                  <button class="btn btn-primary w-100" type="submit">Registrarme</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/storage.js"></script>
  <script src="assets/js/validators.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/ui.js"></script>
  <script>
    buildNavbar();
    const form = document.getElementById('formRegister');
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!form.checkValidity()) { form.classList.add('was-validated'); return; }
      if (form.password.value !== form.confirm.value) { form.confirm.setCustomValidity('mismatch'); form.classList.add('was-validated'); return; }
      form.confirm.setCustomValidity('');
      const ok = registerUser({
        name: form.name.value.trim(),
        email: form.email.value.trim().toLowerCase(),
        password: form.password.value,
        role: form.role.value
      });
      if (!ok) { alert('El correo ya está registrado.'); return; }
      alert('Cuenta creada. Ahora puedes iniciar sesión.');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
