<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Â· Tienda</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <nav id="mainNav" class="navbar navbar-expand-lg navbar-dark bg-primary"></nav>
  <main class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4">Administrador</h1>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalProduct">Nuevo producto</button>
    </div>

    <h2 class="h6 text-uppercase text-muted">Inventario</h2>
    <div id="adminTable" class="table-responsive"></div>

    <!-- Modal producto -->
    <div class="modal fade" id="modalProduct" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Producto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formProduct" novalidate>
              <input type="hidden" id="prodId" />
              <div class="mb-3">
                <label class="form-label" for="prodName">Nombre</label>
                <input id="prodName" class="form-control" required />
              </div>
              <div class="mb-3">
                <label class="form-label" for="prodPrice">Precio</label>
                <input id="prodPrice" class="form-control" type="number" min="0" step="0.01" required />
              </div>
              <div class="mb-3">
                <label class="form-label" for="prodStock">Stock</label>
                <input id="prodStock" class="form-control" type="number" min="0" step="1" required />
              </div>
              <div class="mb-3">
                <label class="form-label" for="prodImage">Imagen (URL)</label>
                <input id="prodImage" class="form-control" type="url" placeholder="https://..." />
              </div>
              <button class="btn btn-primary" type="submit">Guardar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/storage.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/products.js"></script>
  <script src="assets/js/ui.js"></script>
  <script>
    enforceAdmin();
    buildNavbar();
    renderAdmin('#adminTable');

    const form = document.getElementById('formProduct');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!form.checkValidity()){ form.classList.add('was-validated'); return; }
      const dto = {
        id: document.getElementById('prodId').value || undefined,
        name: document.getElementById('prodName').value.trim(),
        price: parseFloat(document.getElementById('prodPrice').value),
        stock: parseInt(document.getElementById('prodStock').value,10),
        image: document.getElementById('prodImage').value.trim()
      };
      upsertProduct(dto);
      bootstrap.Modal.getInstance(document.getElementById('modalProduct')).hide();
      form.reset(); form.classList.remove('was-validated');
      renderAdmin('#adminTable');
    });
  </script>
</body>
</html>
